telegram_control:

    automation:

    ## –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–µ–Ω—é
      - id: –í—ã–∑–æ–≤ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º
        alias: telegram_menu_start
        initial_state: true
        trigger:
          - platform: event
            event_type: telegram_command
            event_data:
              command: '/go'
        action:
          - service: telegram_bot.send_message
            data:
              target: "{{ trigger.event.data.user_id }}"
              message: |
                {{'\U0001F527'}} –í—ã–±—Ä–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
              inline_keyboard: 
              - '{{''\U0001F6B6''}} –í—Ö–æ–¥:/en_control , {{''\U0001F6C0''}} –°–∞–Ω—É–∑–µ–ª:/bt_control'
              - '{{''\U0001F374''}} –ö—É—Ö–Ω—è:/kn_control'
              - '{{''\U0001F6B9''}} –°–ø–∞–ª—å–Ω—è –î:/dd_control , {{''\U0001F6BA''}} –°–ø–∞–ª—å–Ω—è –û:/da_control'
              - '{{''\U0001F6AB''}} –£–±—Ä–∞—Ç—å –º–µ–Ω—é:/menu_hide'

    # ## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω—é
      - id: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º
        alias: telegram_menu_control
        initial_state: true
        trigger:
          - platform: event
            event_type: telegram_callback
            event_data: {}
        action:
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/menu_hide'' }}'
                sequence:
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}' 
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/menu_back'' }}'
                sequence:
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: "{{ trigger.event.data.chat_id }}"
                      message: |
                        {{'\U0001F527'}} –í—ã–±—Ä–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è :
                      inline_keyboard: 
                      - '{{''\U0001F6B6''}} –í—Ö–æ–¥:/en_control , {{''\U0001F6C0''}} –°–∞–Ω—É–∑–µ–ª:/bt_control'
                      - '{{''\U0001F374''}} –ö—É—Ö–Ω—è:/kn_control'
                      - '{{''\U0001F6B9''}} –°–ø–∞–ª—å–Ω—è –î:/dd_control , {{''\U0001F6BA''}} –°–ø–∞–ª—å–Ω—è –û:/da_control'
                      - '{{''\U0001F6AB''}} –£–±—Ä–∞—Ç—å –º–µ–Ω—é:/menu_hide'


    ## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–∂–∞—è, –∫–æ—Ä–∏–¥–æ—Ä
      - id: –ü—Ä–∏—Ö–æ–∂–∞—è –∏ –∫–æ—Ä–∏–¥–æ—Ä –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º
        alias: telegram_en_menu_control
        initial_state: true
        trigger: 
          - platform: event
            event_type: telegram_callback
            event_data: {}
        action:
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/en_control'' }}'
                sequence:
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: &msg_en |
                        {{'\U0001F6B6'}} –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–∂–µ–π:
                        {{'\U0001F6AA'}} –í—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å - {% if is_state('binary_sensor.0x00158d000119378d_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                        {{'\U0001F6AD'}} –î–∞—Ç—á–∏–∫ –¥—ã–º–∞ - {% if is_state('binary_sensor.0x00158d000149d28b_smoke', 'on') %} –û–±–Ω–∞—Ä—É–∂–µ–Ω –¥—ã–º {% else %} –ó–∞–¥—ã–º–ª–µ–Ω–∏—è –Ω–µ—Ç {% endif %}
                        –ü—Ä–∏—Ö–æ–∂–∞—è -
                        {{'\U0001F6B6'}} - {% if is_state('binary_sensor.0x00158d00013f7894_occupancy', 'on') %} –î–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %} 
                        {{'\U0001F321'}} - {{ states('sensor.0x00124b0022659c04_temperature') }} ¬∞C, {{'\U0001F4A7'}} - {{ states('sensor.0x00124b0022659c04_humidity') }} %
                      inline_keyboard: &keyb_en
                        - '{{''\U0001F4A1''}} –õ–∞–º–ø–æ—á–∫–∞ - {% if is_state(''light.0x00158d0003e74c31'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_en_bulb_light , {{''\U0001F4A1''}} –õ—é—Å—Ç—Ä–∞ - {% if is_state(''light.cr_ceiling_light'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_cr_ceiling_light'
                        - '{{''\U000021A9''}} –í–µ—Ä–Ω—É—Ç—å—Å—è:/menu_back , {{''\U000021AA''}} –û–±–Ω–æ–≤–∏—Ç—å:/en_control' 
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_en_bulb_light'' }}'
                sequence:
                  - service: light.toggle
                    entity_id: light.0x00158d0003e74c31
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –õ–∞–º–ø–æ—á–∫–∞ –≤ –ø—Ä–∏—Ö–æ–∂–µ–π - {% if is_state('light.0x00158d0003e74c31', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %} 
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_en
                      inline_keyboard: *keyb_en
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_cr_ceiling_light'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.cr_ceiling_light
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –õ—é—Å—Ç—Ä–∞ –∫–æ—Ä–∏–¥–æ—Ä–∞ - {% if is_state('light.cr_ceiling_light', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %}
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_en
                      inline_keyboard: *keyb_en

    ## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–Ω—É–∑–µ–ª
      - id: –¢—É–∞–ª–µ—Ç, –ø—Ä–∞—á–µ—á–Ω–∞—è, –≤–∞–Ω–Ω–∞—è –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º
        alias: telegram_bt_menu_control
        initial_state: true
        trigger: 
          - platform: event
            event_type: telegram_callback
            event_data: {}
        action:
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/bt_control'' }}'
                sequence:
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: &msg_bt |
                        {{'\U0001F6C0'}} –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É–∞–ª–µ—Ç, –≤–∞–Ω–Ω–∞—è:
                        –¢—É–∞–ª–µ—Ç - 
                        {{'\U0001F6B6'}} - {% if is_state('binary_sensor.0x00158d0001e547a3_occupancy', 'on') %} –î–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %} {{'\U0001F6AA'}} –î–≤–µ—Ä—å - {% if is_state('binary_sensor.0x00158d00054495dc_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                        {{'\U0001F321'}} - {{ states('sensor.0xec1bbdfffe6f3394_temperature') }} ¬∞C, {{'\U0001F4A7'}} - {{ states('sensor.0xec1bbdfffe6f3394_humidity') }} %
                        {{'\U0001F6B1'}} - –£–Ω–∏—Ç–∞–∑ - {% if is_state('binary_sensor.0x00158d0001d72fa2_water_leak', 'on') %} –ü—Ä–æ—Ç–µ—á–∫–∞ {% else %} –°—É—Ö–æ {% endif %}
                        –í–∞–Ω–Ω–∞—è -
                        {{'\U0001F6B6'}} - {% if is_state('binary_sensor.0x00158d0001e547a3_occupancy', 'on') %} –î–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %} {{'\U0001F6AA'}} –î–≤–µ—Ä—å - {% if is_state('binary_sensor.0x00158d00054495dc_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                        {{'\U0001F6B1'}} - –†–∞–∫–æ–≤–∏–Ω–∞ - {% if is_state('binary_sensor.0x00158d0001d72fa2_water_leak', 'on') %} –ü—Ä–æ—Ç–µ—á–∫–∞ {% else %} –°—É—Ö–æ {% endif %} {{'\U0001F6B1'}} - –î—É—à–µ–≤–∞—è - {% if is_state('binary_sensor.0x00158d0001bb60c2_water_leak', 'on') %} –ü—Ä–æ—Ç–µ—á–∫–∞ {% else %} –°—É—Ö–æ {% endif %}
                        {{'\U0001F321'}} - {{ states('sensor.0x00158d0001dcd47e_temperature') }} ¬∞C, {{'\U0001F4A7'}} - {{ states('sensor.0x00158d0001dcd47e_humidity') }} %
                      inline_keyboard: &keyb_bt
                        - '{{''\U0001F4A1''}} –¢—É–∞–ª–µ—Ç - {% if is_state(''light.tt_ceiling_light'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_tt_ceiling_light , {{''\U0001F300''}} –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä - {% if is_state(''switch.0x00158d0001117040_left'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_bt_fan'
                        - '{{''\U0001F4A1''}} –í–∞–Ω–Ω–∞—è - {% if is_state(''light.bt_ceiling_light'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_bt_ceiling_light , {{''\U00002668''}} –°—É—à–∏–ª–∫–∞ - {% if is_state(''switch.heater_mode'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_bt_boiler_mode'
                        - '{{''\U000021A9''}} –í–µ—Ä–Ω—É—Ç—å—Å—è:/menu_back , {{''\U000021AA''}} –û–±–Ω–æ–≤–∏—Ç—å:/bt_control' 
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_tt_ceiling_light'' }}'
                sequence:
                  - service: light.toggle
                    entity_id: light.tt_ceiling_light
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –õ—é—Å—Ç—Ä–∞ —Ç—É–∞–ª–µ—Ç–∞ - {% if is_state('light.tt_ceiling_light', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %}
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_bt
                      inline_keyboard: *keyb_bt
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_bt_ceiling_light'' }}'
                sequence:
                  - service: input_button.press
                    target:
                        entity_id: input_button.bt_ceiling_light
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –õ—é—Å—Ç—Ä–∞ –≤–∞–Ω–Ω–æ–π - {% if is_state('light.bt_ceiling_light', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %}
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_bt
                      inline_keyboard: *keyb_bt
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_bt_fan'' }}'
                sequence:
                  - service: switch.toggle
                    entity_id: switch.0x00158d0001117040_left
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä —Ç—É–∞–ª–µ—Ç–∞ - {% if is_state('switch.0x00158d0001117040_left', 'on') %} –í–∫–ª—é—á–µ–Ω {% else %} –í—ã–∫–ª—é—á–µ–Ω {% endif %}
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_bt
                      inline_keyboard: *keyb_bt
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_bt_boiler_mode'' }}'
                sequence:
                  - service: switch.toggle
                    entity_id: switch.heater_mode
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –ü–æ–ª–æ—Ç–µ–Ω—Ü–µ—Å—É—à–∏–ª–∫–∞ - {% if is_state('switch.heater_mode', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %}
                      show_alert: true
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_bt
                      inline_keyboard: *keyb_bt
    ## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö—É—Ö–Ω—è
      - id: –ö—É—Ö–Ω—è –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º–º
        alias: telegram_kn_menu_control
        initial_state: true
        trigger: 
          - platform: event
            event_type: telegram_callback
            event_data: {}
        action:
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/kn_control'' }}'
                sequence:
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: &msg_kn |
                        {{'\U0001F374'}} –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ö–Ω–∏:
                        –ö—É—Ö–Ω—è - 
                        {{'\U0001F6B6'}} - {% if is_state('binary_sensor.0x00158d0001e547a3_occupancy', 'on') %} –î–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %} {{'\U0001F6AA'}} –î–≤–µ—Ä—å - {% if is_state('binary_sensor.0x00158d00054495dc_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                        {{'\U0001F321'}} - {{ states('sensor.0xec1bbdfffe6f3394_temperature') }} ¬∞C, {{'\U0001F4A7'}} - {{ states('sensor.0xec1bbdfffe6f3394_humidity') }} %
                        {{'\U0001F6B1'}} - –†–∞–∫–æ–≤–∏–Ω–∞ - {% if is_state('binary_sensor.0x00158d0001d72fa2_water_leak', 'on') %} –ü—Ä–æ—Ç–µ—á–∫–∞ {% else %} –°—É—Ö–æ {% endif %}
                        –ë–∞–ª–∫–æ–Ω -
                        {{'\U0001F6B6'}} - {% if is_state('binary_sensor.0x00158d0001e547a3_occupancy', 'on') %} –î–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %} {{'\U0001F6AA'}} –î–≤–µ—Ä—å - {% if is_state('binary_sensor.0x00158d00054495dc_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                        {{'\U0001F321'}} - {{ states('sensor.0x00158d0001dcd47e_temperature') }} ¬∞C, {{'\U0001F4A7'}} - {{ states('sensor.0x00158d0001dcd47e_humidity') }} %
                      inline_keyboard: &keyb_kn
                        - '{{''\U0001F4A1''}} –ö—É—Ö–Ω—è - {% if is_state(''light.kn_ceiling_light'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_kn_ceiling_light , {{''\U0001F300''}} –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä - {% if is_state(''switch.0x00158d0001117040_left'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_kn_fan'
                        - '{{''\U000021A9''}} –í–µ—Ä–Ω—É—Ç—å—Å—è:/menu_back , {{''\U000021AA''}} –û–±–Ω–æ–≤–∏—Ç—å:/kn_control'
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_kn_ceiling_light'' }}'
                sequence:
                  - service: light.toggle
                    entity_id: light.tt_ceiling_light
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –õ—é—Å—Ç—Ä–∞ –∫—É—Ö–Ω–∏ - {% if is_state('light.kn_ceiling_light', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %}
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_kn
                      inline_keyboard: *keyb_kn
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_kn_fan'' }}'
                sequence:
                  - service: switch.toggle
                    entity_id: switch.0x00158d0001117040_left
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∫—É—Ö–Ω–∏ - {% if is_state('switch.0x00158d0001117040_left', 'on') %} –í–∫–ª—é—á–µ–Ω {% else %} –í—ã–∫–ª—é—á–µ–Ω {% endif %}
                      show_alert: true
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_kn
                      inline_keyboard: *keyb_kn
    ## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–ø–∞–ª—å–Ω–∏ –î
      - id: –°–ø–∞–ª—å–Ω—è –î –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–ª–µ–≥—Ä–∞–º–º
        alias: telegram_dd_menu_control
        initial_state: true
        trigger: 
          - platform: event
            event_type: telegram_callback
            event_data: {}
        action:
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/dd_control'' }}'
                sequence:
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: &msg_dd |
                        {{'\U0001F6B9'}} –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–ø–∞–ª—å–Ω–∏ –î:
                        –°–ø–∞–ª—å–Ω—è - 
                        {{'\U0001F6B6'}} - {% if is_state('binary_sensor.0x00158d0001e547a3_occupancy', 'on') %} –î–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %} {{'\U0001F6AA'}} –î–≤–µ—Ä—å - {% if is_state('binary_sensor.0x00158d00054495dc_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                        {{'\U0001F321'}} - {{ states('sensor.0xec1bbdfffe6f3394_temperature') }} ¬∞C, {{'\U0001F4A7'}} - {{ states('sensor.0xec1bbdfffe6f3394_humidity') }} %
                        –ë–∞–ª–∫–æ–Ω -
                        {{'\U0001F6B6'}} - {% if is_state('binary_sensor.0x00158d0001e547a3_occupancy', 'on') %} –î–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %} {{'\U0001F6AA'}} –î–≤–µ—Ä—å - {% if is_state('binary_sensor.0x00158d00054495dc_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                        {{'\U0001F321'}} - {{ states('sensor.0x00158d0001dcd47e_temperature') }} ¬∞C, {{'\U0001F4A7'}} - {{ states('sensor.0x00158d0001dcd47e_humidity') }} %
                      inline_keyboard: &keyb_dd
                        - '{{''\U0001F4A1''}} –°–ø–∞–ª—å–Ω—è - {% if is_state(''light.dd_ceiling_light'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_dd_ceiling_light , {{''\U0001F308''}} WLed –ª–µ–Ω—Ç–∞ - {% if is_state(''switch.0x00158d0001117040_left'', ''off'')%}{{''üî¥''}}{% else %}{{''üü¢''}}{% endif %}:/toggle_dd_fan'
                        - '{{''\U000021A9''}} –í–µ—Ä–Ω—É—Ç—å—Å—è:/menu_back , {{''\U000021AA''}} –û–±–Ω–æ–≤–∏—Ç—å:/dd_control'
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_dd_ceiling_light'' }}'
                sequence:
                  - service: light.toggle
                    entity_id: light.tt_ceiling_light
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F4AC"}} –õ—é—Å—Ç—Ä–∞ –°–ø–∞–ª—å–Ω–∏ –î - {% if is_state('light.dd_ceiling_light', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %}
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_dd
                      inline_keyboard: *keyb_dd
              - conditions:
                  - condition: template
                    value_template: '{{ trigger.event.data.command == ''/toggle_dd_fan'' }}'
                sequence:
                  - service: switch.toggle
                    entity_id: switch.0x00158d0001117040_left
                  - delay:
                      milliseconds: 500
                  - service: telegram_bot.answer_callback_query
                    data:
                      callback_query_id: "{{ trigger.event.data.id }}"
                      message: | 
                          {{"\U0001F308"}} WLed –ª–µ–Ω—Ç–∞ - {% if is_state('switch.0x00158d0001117040_left', 'on') %} –í–∫–ª—é—á–µ–Ω–∞ {% else %} –í—ã–∫–ª—é—á–µ–Ω–∞ {% endif %}
                      show_alert: true
                  - service: telegram_bot.delete_message
                    data_template:
                      message_id: '{{ trigger.event.data.message.message_id }}'
                      chat_id: '{{ trigger.event.data.chat_id }}'
                  - service: telegram_bot.send_message
                    data:
                      target: '{{ trigger.event.data.chat_id }}'
                      message: *msg_dd
                      inline_keyboard: *keyb_dd